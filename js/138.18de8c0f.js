"use strict";(self["webpackChunkproject"]=self["webpackChunkproject"]||[]).push([[138],{8266:function(t,e,o){o.d(e,{Z:function(){return u}});var a=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"modal fade",attrs:{id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"}},[e("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[e("div",{staticClass:"modal-content border-0"},[t._m(0),e("div",{staticClass:"modal-body"},[t._v(" 是否刪除 "),e("strong",{staticClass:"text-danger"},[t._v(t._s(t.item.title))]),t._v(" 商品(刪除後將無法恢復)。 ")]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button","data-bs-dismiss":"modal"}},[t._v(" 取消 ")]),e("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:t.delProduct}},[t.status.update?e("i",{staticClass:"fas fa-spinner fa-spin me-1"}):t._e(),t._v("確認刪除")])])])])])])},s=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal-header bg-danger text-white"},[e("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[e("span",[t._v("刪除產品")])]),e("button",{staticClass:"btn-close",attrs:{type:"button","data-bs-dismiss":"modal","aria-label":"Close"}})])}],n={props:["item","status"],methods:{delProduct(){this.$emit("delete")}}},i=n,d=o(1001),l=(0,d.Z)(i,a,s,!1,null,null,null),u=l.exports},5138:function(t,e,o){o.r(e),o.d(e,{default:function(){return v}});var a=function(){var t=this,e=t._self._c;return e("div",[e("loading",{attrs:{active:t.isLoading},on:{"update:active":function(e){t.isLoading=e}}}),e("div",{staticClass:"text-end"},[e("button",{staticClass:"btn btn-primary mt-3",on:{click:function(e){return t.openModal(!0)}}},[t._v(" 建立新的優惠券 ")])]),e("Table",{directives:[{name:"show",rawName:"v-show",value:t.coupons.length>0,expression:"coupons.length > 0"}],attrs:{item:t.tempCoupon,products:t.coupons},on:{edit:t.openModal,delete:t.delModal},scopedSlots:t._u([{key:"thead",fn:function(){return[e("tr",[e("th",[t._v("名稱")]),e("th",[t._v("優惠碼")]),e("th",[t._v("折扣百分比")]),e("th",[t._v("到期日")]),e("th",[t._v("是否啟用")]),e("th",[t._v("編輯")])])]},proxy:!0},{key:"tbody",fn:function(){return t._l(t.coupons,(function(o){return e("tr",{key:o.id},[e("td",[t._v(t._s(o.title))]),e("td",[t._v(t._s(o.code))]),e("td",[t._v(t._s(o.percent)+"%")]),e("td",[t._v(t._s(t._f("date")(o.due_date)))]),e("td",[1===o.is_enabled?e("span",{staticClass:"text-success"},[t._v("啟用")]):e("span",{staticClass:"text-muted"},[t._v("未起用")])]),e("td",[e("button",{staticClass:"btn btn-outline-primary btn-sm me-2",on:{click:function(e){return t.openModal(!1,o)}}},[t._v(" 編輯 ")]),e("button",{staticClass:"btn btn-danger btn-sm",on:{click:function(e){return t.delModal(o)}}},[t._v(" 刪除 ")])])])}))},proxy:!0}])}),e("div",{staticClass:"d-flex justify-content-center"},[e("Pagination",{directives:[{name:"show",rawName:"v-show",value:t.coupons.length>0,expression:"coupons.length > 0"}],attrs:{pagination:t.pagination},on:{pageItem:t.getCoupons}})],1),e("Modal",{attrs:{item:t.tempCoupon,"is-new":t.isNew,status:t.status},on:{update:t.updateCoupon},scopedSlots:t._u([{key:"modalTitle",fn:function(){return[t.isNew?e("span",[t._v("建立優惠券")]):e("span",[t._v("修改優惠券")])]},proxy:!0},{key:"modalBody",fn:function(){return[e("div",{staticClass:"mb-3"},[e("label",{staticClass:"form-label",attrs:{for:"title"}},[t._v("標題")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempCoupon.title,expression:"tempCoupon.title"}],staticClass:"form-control",attrs:{type:"text",id:"title",placeholder:"請輸入標題"},domProps:{value:t.tempCoupon.title},on:{input:function(e){e.target.composing||t.$set(t.tempCoupon,"title",e.target.value)}}})]),e("div",{staticClass:"mb-3"},[e("label",{staticClass:"form-label",attrs:{for:"coupon_code"}},[t._v("優惠碼")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempCoupon.code,expression:"tempCoupon.code"}],staticClass:"form-control",attrs:{type:"text",id:"coupon_code",placeholder:"請輸入優惠碼"},domProps:{value:t.tempCoupon.code},on:{input:function(e){e.target.composing||t.$set(t.tempCoupon,"code",e.target.value)}}})]),e("div",{staticClass:"mb-3"},[e("label",{staticClass:"form-label",attrs:{for:"due_date"}},[t._v("到期日")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.due_date,expression:"due_date"}],staticClass:"form-control",attrs:{type:"date",id:"due_date"},domProps:{value:t.due_date},on:{input:function(e){e.target.composing||(t.due_date=e.target.value)}}})]),e("div",{staticClass:"mb-3"},[e("label",{staticClass:"form-label",attrs:{for:"price"}},[t._v("折扣百分比")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempCoupon.percent,expression:"tempCoupon.percent"}],staticClass:"form-control",attrs:{type:"number",id:"price",placeholder:"請輸入折扣百分比"},domProps:{value:t.tempCoupon.percent},on:{input:function(e){e.target.composing||t.$set(t.tempCoupon,"percent",e.target.value)}}})]),e("div",{staticClass:"mb-3"},[e("div",{staticClass:"form-check"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempCoupon.is_enabled,expression:"tempCoupon.is_enabled"}],staticClass:"form-check-input",attrs:{type:"checkbox","true-value":1,"false-value":0,id:"is_enabled"},domProps:{checked:Array.isArray(t.tempCoupon.is_enabled)?t._i(t.tempCoupon.is_enabled,null)>-1:t._q(t.tempCoupon.is_enabled,1)},on:{change:function(e){var o=t.tempCoupon.is_enabled,a=e.target,s=a.checked?1:0;if(Array.isArray(o)){var n=null,i=t._i(o,n);a.checked?i<0&&t.$set(t.tempCoupon,"is_enabled",o.concat([n])):i>-1&&t.$set(t.tempCoupon,"is_enabled",o.slice(0,i).concat(o.slice(i+1)))}else t.$set(t.tempCoupon,"is_enabled",s)}}}),e("label",{staticClass:"form-check-label",attrs:{for:"is_enabled"}},[t._v(" 是否啟用 ")])])])]},proxy:!0},{key:"modalFooter",fn:function(){},proxy:!0}])}),e("DeleteModal",{attrs:{item:t.tempCoupon,status:t.status},on:{delete:t.deleteCoupon}})],1)},s=[],n=o(2166),i=o(8266),d=o(5196),l=o(9143),u=o(1863),p={data(){return{coupons:[],tempCoupon:{title:"",is_enabled:1,percent:100,due_date:0,code:""},status:{update:!1},due_date:new Date,isNew:!1,pagination:{},isLoading:!1}},watch:{due_date(){const t=this,e=Math.floor(new Date(t.due_date)/1e3);t.tempCoupon.due_date=e}},methods:{openModal(t,e){const o=this;if(o.isNew=t,o.isNew)o.tempCoupon={};else{o.tempCoupon=Object.assign({},e);const t=new Date(1e3*o.tempCoupon.due_date).toISOString().split("T");o.due_date=t[0]}const a=new n.u_("#modalComponent");a.show()},delModal(t){const e=this;e.tempCoupon=Object.assign({},t);const o=new n.u_("#delModal");o.show()},hideModal(){const t=document.querySelector("#modalComponent"),e=n.u_.getInstance(t);e.hide()},hideDelModal(){const t=document.querySelector("#delModal"),e=n.u_.getInstance(t);e.hide()},getCoupons(t=1){const e=this,o=`https://vue-course-api.hexschool.io/api/gunshop/admin/coupons?page=${t}`;e.isLoading=!0,e.$http.get(o,e.tempCoupon).then((t=>{e.coupons=t.data.coupons,e.pagination=t.data.pagination,console.log(t),e.isLoading=!1}))},updateCoupon(){const t=this;let e;t.status.update=!0,t.isNew?(e="https://vue-course-api.hexschool.io/api/gunshop/admin/coupon",t.isLoading=!0,t.$http.post(e,{data:t.tempCoupon}).then((e=>{t.status.update=!1,t.$bus.$emit("msg-pop",e.data.message,"success"),t.hideModal(),t.getCoupons(),t.isLoading=!1}))):(e=`https://vue-course-api.hexschool.io/api/gunshop/admin/coupon/${t.tempCoupon.id}`,t.due_date=new Date(1e3*t.tempCoupon.due_date),t.isLoading=!0,t.$http.put(e,{data:t.tempCoupon}).then((e=>{t.status.update=!1,t.hideModal(),t.$bus.$emit("msg-pop",e.data.message,"success"),t.getCoupons(),t.isLoading=!1})))},deleteCoupon(){const t=this,e=`https://vue-course-api.hexschool.io/api/gunshop/admin/coupon/${t.tempCoupon.id}`;t.status.update=!0,t.isLoading=!0,t.$http.delete(e).then((e=>{t.status.update=!1,t.$bus.$emit("msg-pop",e.data.message,"success"),t.hideDelModal(),t.isLoading=!1,t.getCoupons()}))}},created(){this.getCoupons()},components:{Modal:d.Z,DeleteModal:i.Z,Pagination:l.Z,Table:u.Z}},c=p,r=o(1001),m=(0,r.Z)(c,a,s,!1,null,null,null),v=m.exports}}]);
//# sourceMappingURL=138.18de8c0f.js.map