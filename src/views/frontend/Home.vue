<template>
  <div class="Home">
    <Jumbotron></Jumbotron>
    <section class="intro p-5 text-white">
      <div class="container">
        <div class="row">
          <div class="col-md-4 d-flex">
            <div class="icon me-3">
              <img
                class="icon"
                src="@/assets/images/support_hand_customer_icon.png"
                alt="customer_icon"
              />
            </div>
            <div class="text">
              <h3>24小時線上客服</h3>
              <p>如有商品以及其他相關問題，我們可隨時為您解答</p>
            </div>
          </div>
          <div class="col-md-4 d-flex">
            <div class="icon me-3">
              <img
                class="icon"
                src="@/assets/images/lock_login_protection_secure_icon.png"
                alt="secure_icon"
              />
            </div>
            <div class="text">
              <h3>安全的付款系統</h3>
              <p>讓您的資料能夠安全保存</p>
            </div>
          </div>
          <div class="col-md-4 d-flex">
            <div class="icon me-3">
              <img
                class="icon"
                src="@/assets/images/delivery_fast_quick_truck_logistics_icon.png"
                alt="truck_logistics_icon"
              />
            </div>
            <div class="text">
              <h3>快速到貨</h3>
              <p>下單後在三天內保證到貨</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="about-us my-5">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <img
              class="img-fluid about-img"
              src="https://images.unsplash.com/photo-1618498108876-f3a1d1cff073?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTMxfHxndW58ZW58MHx8MHx8&auto=format&fit=crop&w=500&q=60"
              alt="about-img"
            />
          </div>
          <div class="col-md-8">
            <div class="about-content">
              <span class="text-danger">Since 1905</span>
              <h2>Desire Meets A New Taste</h2>
              <p>
                A small river named Duden flows by their place and supplies it
                with the necessary regelialia. It is a paradisematic country, in
                which roasted parts of sentences fly into your mouth.
              </p>
              <p>
                On her way she met a copy. The copy warned the Little Blind
                Text, that where it came from it would have been rewritten a
                thousand times and everything that was left from its origin
                would be the word "and" and the Little Blind Text should turn
                around and return to its own, safe country.
              </p>
              <h3>
                <strong class="text-danger">115</strong> Years of Experience In
                Business
              </h3>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="category my-5">
      <div class="container">
        <h2 class="text-center my-3">商品種類</h2>
        <div class="row">
          <div class="col-lg-2 col-md-4 col-6 my-3">
            <div class="type text-center">
              <div
                class="img"
                style="
                  background-image: url(https://images.unsplash.com/photo-1595590424283-b8f17842773f?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8M3x8aGFuZGd1bnxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=500&q=60);
                "
              ></div>
              <h3>手槍</h3>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-6 my-3">
            <div class="type text-center">
              <div
                class="img"
                style="
                  background-image: url(https://images.unsplash.com/photo-1610165539750-051008c3e799?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTJ8fFJJRkxFU3xlbnwwfHwwfHw%3D&auto=format&fit=crop&w=500&q=60);
                "
              ></div>
              <h3>步槍</h3>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-6 my-3">
            <div class="type text-center">
              <div
                class="img"
                style="
                  background-image: url(https://images.unsplash.com/photo-1639064565839-af6a5c93b116?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTZ8fFNIT1RHVU58ZW58MHx8MHx8&auto=format&fit=crop&w=500&q=60);
                "
              ></div>
              <h3>霰彈槍</h3>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-6 my-3">
            <div class="type text-center">
              <div
                class="img"
                style="
                  background-image: url(https://images.unsplash.com/photo-1580865783874-7d9e701e858a?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8YW1tb3xlbnwwfHwwfHw%3D&auto=format&fit=crop&w=500&q=60);
                "
              ></div>
              <h3>彈藥</h3>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-6 my-3">
            <div class="type text-center">
              <div
                class="img"
                style="
                  background-image: url(https://images.unsplash.com/photo-1614101081328-4083f3ab0bab?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTZ8fGtuaXZlfGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60);
                "
              ></div>
              <h3>裝備</h3>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-6 my-3">
            <div class="type text-center">
              <div
                class="img"
                style="
                  background-image: url(https://images.unsplash.com/photo-1511989130945-c2b632959395?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8TWlsaXRhcnl8ZW58MHx8MHx8&auto=format&fit=crop&w=500&q=60);
                "
              ></div>
              <h3>其他</h3>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="product my-5">
      <div class="container">
        <h2 class="text-center my-3">熱銷商品</h2>
        <div class="row">
          <div
            class="col-lg-3 col-md-6 col-12 my-3"
            v-for="item in products.slice(0, 8)"
            :key="item.id"
          >
            <Card
              :item="item"
              :status="status"
              @getItem="getProduct(item.id)"
              @addCart="addCart(item.id)"
            ></Card>
          </div>
        </div>
      </div>
    </section>

    <section class="customer">
      <div class="overlay"></div>
      <div class="container">
        <div class="text-center text-white py-5">
          <h4>使用者體驗</h4>
          <h2>我們的忠實客戶</h2>
        </div>
        <carousel>
          <div v-for="item in 6" :key="item.id">
            <div class="card item mx-2">
              <div class="card-body">
                <p class="card-text">
                  Lorem, ipsum dolor sit amet consectetur adipisicing elit.
                  Ipsam, iste!
                </p>
                <div class="d-flex align-items-center">
                  <div class="me-3">
                    <img class="avatar" :src="user.picture" alt="avatar" />
                  </div>

                  <div class="user-info">
                    <p>{{ user.firstName }} {{ user.lastName }}</p>
                    <span>{{ user.email }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </carousel>
      </div>
    </section>

    <section class="blog">
      <div class="container">
        <h2 class="text-center my-3">Recent Blog</h2>
        <div class="row">
          <div class="col-lg-6">
            <div class="blog-entry d-flex">
              <a href="#">
                <img
                  class="img-fluid h-100"
                  src="https://images.unsplash.com/photo-1610165539750-051008c3e799?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8NjV8fGd1bnxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=500&q=60"
                  alt=""
                />
              </a>
              <div class="text p-3 bg-light">
                <div class="date">
                  <i class="fa-regular fa-calendar-days"></i>
                  <span class="ms-2">23 April 2020</span>
                </div>
                <h3 class="py-2">The Recipe from a Winemaker’s Restaurent</h3>
                <p>
                  A small river named Duden flows by their place and supplies it
                  with the necessary regelialia.
                </p>
                <a class="btn-custom" href="#">查看 →</a>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="blog-entry d-flex">
              <a href="#">
                <img
                  class="img-fluid h-100"
                  src="https://images.unsplash.com/photo-1619760564549-1c0133051138?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTA1fHxndW58ZW58MHx8MHx8&auto=format&fit=crop&w=500&q=60"
                  alt=""
                />
              </a>
              <div class="text p-3 bg-light">
                <div class="date">
                  <i class="fa-regular fa-calendar-days"></i>
                  <span class="ms-2">23 April 2020</span>
                </div>
                <h3 class="py-2">The Recipe from a Winemaker’s Restaurent</h3>
                <p>
                  A small river named Duden flows by their place and supplies it
                  with the necessary regelialia.
                </p>
                <a class="btn-custom" href="#">查看 →</a>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="blog-entry d-flex">
              <a href="#">
                <img
                  class="img-fluid h-100"
                  src="https://images.unsplash.com/photo-1622702203226-0f2e6620fbcf?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8ODl8fGd1bnxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=500&q=60"
                  alt=""
                />
              </a>
              <div class="text p-3 bg-light">
                <div class="date">
                  <i class="fa-regular fa-calendar-days"></i>
                  <span class="ms-2">23 April 2020</span>
                </div>
                <h3 class="py-2">The Recipe from a Winemaker’s Restaurent</h3>
                <p>
                  A small river named Duden flows by their place and supplies it
                  with the necessary regelialia.
                </p>
                <a class="btn-custom" href="#">查看 →</a>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="blog-entry d-flex">
              <a href="#">
                <img
                  class="img-fluid h-100"
                  src="https://images.unsplash.com/photo-1583960363463-3dd2a0999c17?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTA3fHxndW58ZW58MHx8MHx8&auto=format&fit=crop&w=500&q=60"
                  alt=""
                />
              </a>
              <div class="text p-3 bg-light">
                <div class="date">
                  <i class="fa-regular fa-calendar-days"></i>
                  <span class="ms-2">23 April 2020</span>
                </div>
                <h3 class="py-2">The Recipe from a Winemaker’s Restaurent</h3>
                <p>
                  A small river named Duden flows by their place and supplies it
                  with the necessary regelialia.
                </p>
                <a class="btn-custom" href="#">查看 →</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- <carousel>
      <img class="img-fluid" src="https://placeimg.com/200/200/any?1">
      <img class="img-fluid" src="https://placeimg.com/200/200/any?2">
      <img class="img-fluid" src="https://placeimg.com/200/200/any?3">
      <img class="img-fluid" src="https://placeimg.com/200/200/any?4">
    </carousel> -->

    <Modal>
      <template v-slot:modalTitle>
        {{ product.title }}
      </template>
      <template v-slot:modalBody>
        <div class="row">
          <div class="col-md-6">
            <img
              :src="product.imageUrl"
              class="img-fluid"
              :alt="product.title"
            />
          </div>
          <div class="col-md-6">
            <blockquote class="blockquote mt-3">
              <p class="mb-3">{{ product.content }}</p>
            </blockquote>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-baseline">
          <div class="h4" v-if="!product.price">
            {{ product.origin_price }} 元
          </div>
          <del class="h6" v-if="product.price"
            >原價 {{ product.origin_price }} 元</del
          >
          <div class="h4 text-danger" v-if="product.price">
            現在只要 {{ product.price }} 元
          </div>
        </div>
        <select class="form-select mt-3" v-model="product.num">
          <option :value="num" v-for="num in 10" :key="num">
            選購 {{ num }} <span v-if="!product.unit">個</span>
            {{ product.unit }}
          </option>
        </select>
      </template>
      <template v-slot:modalFooter>
        <div class="text-muted text-nowrap me-3">
          小計 <strong>{{ product.num * product.price }}</strong> 元
        </div>
        <button
          type="button"
          class="btn btn-primary"
          @click="addCart(product.id, product.num)"
        >
          <i
            class="fas fa-spinner fa-spin me-1"
            v-if="product.id === status.addCart"
          ></i>
          加到購物車
        </button>
      </template>
    </Modal>
  </div>
</template>

<script>
import * as bootstrap from "bootstrap";
import Card from "@/components/Card.vue";
import Jumbotron from "@/components/frontend/Jumbotron.vue";
import Modal from "@/components/Modal.vue";
import carousel from "vue-owl-carousel";
export default {
  components: { Jumbotron, Card, Modal, carousel },
  data() {
    return {
      products: [],
      product: {},
      status: {
        info: "",
        addCart: "",
        delete: "",
      },
      user: {
        firstName: "John",
        lastName: "Doe",
        email: "john@gmail.com",
        gender: "male",
        picture: "https://randomuser.me/api/portraits/men/10.jpg",
      },
    };
  },
  methods: {
    getProducts() {
      const vm = this;
      const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/products/all`;
      vm.$http.get(url).then((response) => {
        vm.products = response.data.products;
      });
    },
    getProduct(id) {
      const vm = this;
      const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/product/${id}`;
      vm.status.info = id;
      vm.$http.get(url).then((response) => {
        vm.product = response.data.product;
        const myModal = new bootstrap.Modal("#modalComponent");
        myModal.show();
        // console.log(response);
        vm.status.info = "";
      });
    },
    addCart(id, qty = 1) {
      const vm = this;
      const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/cart`;
      vm.status.addCart = id;
      const cart = {
        product_id: id,
        qty,
      };
      vm.$http.post(url, { data: cart }).then((response) => {
        vm.$bus.$emit("msg-pop", response.data.message, "success");
        // console.log(response);
        vm.status.addCart = "";
        vm.getCart();
        vm.hideModal();
      });
    },
    hideModal() {
      const myModal = document.querySelector("#modalComponent");
      const modal = bootstrap.Modal.getInstance(myModal);
      // 避免快速加入購物車出現錯誤
      if (myModal.classList.contains("show")) {
        modal.hide();
      }
    },
    async getUser() {
      const res = await fetch("https://randomuser.me/api");
      const { results } = await res.json();
      console.log(results);
      this.user.firstName = results[0].name.first;
      this.user.lastName = results[0].name.last;
      this.user.email = results[0].email;
      this.user.gender = results[0].gender;
      this.user.picture = results[0].picture.large;
    },
  },
  created() {
    this.getProducts();
    this.getUser();
  },
};
</script>

<style lang="scss" scope>
.intro {
  background: #b7472a;
}

.img {
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center center;
  display: block;
  margin: 0 auto;
}

.category .img {
  width: 130px;
  height: 130px;
  border-radius: 50%;
  margin-bottom: 1rem;
  position: relative;
  z-index: 0;
  cursor: pointer;
}

.category .img::after {
  position: absolute;
  top: -10px;
  bottom: -10px;
  right: -10px;
  left: -10px;
  content: "";
  border-radius: 50%;
  z-index: -1;
  border: 1px solid #b7472a;
  transition: all 0.6s;
}

.icon {
  filter: brightness(0) invert(1);
}

.customer {
  background-image: url(https://images.seattletimes.com/wp-content/uploads/2020/04/04012020_Gun_shops_150718.jpg?d=1560x989);
  z-index: 0;
  position: relative;
  background-attachment: fixed;
  background-size: cover;
  height: 50vh;

  @media (max-width: 576px) {
    height: 100vh;
  }
}

.overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: #000;
  opacity: 0.7;
  z-index: -1;
}

.item {
  background-color: transparent;
  color: #fff;
  border: 1px solid #fff;
}

.avatar {
  border-radius: 50%;
  width: 80px;
  height: 80px;
}

.btn-custom {
  text-decoration: none;
  color: #b7472a;
  font-style: italic;
  font-weight: 700;
}

.blog-entry {
  margin-bottom: 1.5rem;
}
</style>
